"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.personalize = void 0;
// © Sitecore Corporation A/S. All rights reserved. Sitecore® is a registered trademark of Sitecore Corporation A/S.
const internal_1 = require("@sitecore-cloudsdk/core/internal");
const utils_1 = require("@sitecore-cloudsdk/utils");
const consts_1 = require("../consts");
const initializer_1 = require("../initializer/browser/initializer");
const personalizer_1 = require("./personalizer");
/**
 * A function that executes an interactive experiment or web experiment over any web-based or mobile application.
 * @param personalizeData - The required/optional attributes in order to create a flow execution
 * @param opts - An object containing additional options.
 * @returns A flow execution response
 */
async function personalize(personalizeData, opts) {
    await (0, initializer_1.awaitInit)();
    const cloudSDKSettings = (0, internal_1.getCloudSDKSettingsBrowser)();
    const personalizeSettings = (0, internal_1.getEnabledPackageBrowser)(consts_1.PACKAGE_NAME)?.settings;
    const browserId = (0, utils_1.getCookieValueClientSide)(cloudSDKSettings.cookieSettings.name.browserId);
    const guestId = (0, utils_1.getCookieValueClientSide)(personalizeSettings.cookieSettings.name.guestId);
    return new personalizer_1.Personalizer(browserId, guestId).getInteractiveExperienceData(personalizeData, cloudSDKSettings, window.location.search, {
        timeout: opts?.timeout
    });
}
exports.personalize = personalize;
