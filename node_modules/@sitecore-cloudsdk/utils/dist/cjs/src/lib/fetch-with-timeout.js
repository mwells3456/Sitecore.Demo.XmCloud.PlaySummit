"use strict";
// © Sitecore Corporation A/S. All rights reserved. Sitecore® is a registered trademark of Sitecore Corporation A/S.
Object.defineProperty(exports, "__esModule", { value: true });
exports.fetchWithTimeout = void 0;
const consts_1 = require("./consts");
/**
 * Fetches data from the specified URL within the given timeout period.
 *
 * @param url - The URL to fetch data from.
 * @param timeout - The time in milliseconds to wait before timing out the request.
 * @param fetchOptions - The options to pass to the fetch API.
 * @returns - A Promise that resolves to the fetched data, or null if the request was aborted or timed out.
 * @throws  - If the timeout value is invalid.
 */
async function fetchWithTimeout(url, timeout, fetchOptions) {
    if (!Number.isInteger(timeout) || timeout < 0)
        throw new Error(consts_1.ErrorMessages.IV_0006);
    const abortController = new AbortController();
    const signal = abortController.signal;
    const timeoutHandler = setTimeout(() => {
        abortController.abort();
    }, timeout);
    return fetch(url, { ...fetchOptions, signal })
        .then((response) => {
        clearTimeout(timeoutHandler);
        return response;
    })
        .catch((error) => {
        if (error.name === 'AbortError')
            throw new Error(consts_1.ErrorMessages.IE_0002);
        return null;
    });
}
exports.fetchWithTimeout = fetchWithTimeout;
