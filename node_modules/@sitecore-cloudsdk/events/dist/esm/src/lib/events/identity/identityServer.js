import { getCloudSDKSettingsServer as getCloudSDKSettings, getCookieValueFromRequest } from '@sitecore-cloudsdk/core/internal';
import { verifyEventsPackageExistence } from '../../initializer/server/initializer';
import { sendEvent } from '../send-event/sendEvent';
import { IdentityEvent } from './identity-event';
/**
 * A function that sends an IDENTITY event to SitecoreCloud API
 *
 * @param request - Interface with constraint for extending request
 * @param identityData - The required/optional attributes in order to be send to SitecoreCloud API
 * @returns The response object that Sitecore EP returns
 */
export function identityServer(request, identityData) {
    verifyEventsPackageExistence();
    const settings = getCloudSDKSettings();
    const browserId = getCookieValueFromRequest(request, settings.cookieSettings.name.browserId);
    return new IdentityEvent({
        id: browserId,
        identityData,
        sendEvent,
        settings
    }).send();
}
