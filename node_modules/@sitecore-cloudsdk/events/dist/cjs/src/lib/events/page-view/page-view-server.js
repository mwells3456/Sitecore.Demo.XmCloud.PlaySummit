"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.pageViewServer = void 0;
const internal_1 = require("@sitecore-cloudsdk/core/internal");
const initializer_1 = require("../../initializer/server/initializer");
const sendEvent_1 = require("../send-event/sendEvent");
const page_view_event_1 = require("./page-view-event");
/**
 * A function that sends a VIEW event to SitecoreCloud API
 *
 * @param request - Interface with constraint for extending request
 * @param pageViewData - The required/optional attributes in order to be send to SitecoreCloud API
 * @returns The response object that Sitecore EP returns
 */
function pageViewServer(request, pageViewData) {
    (0, initializer_1.verifyEventsPackageExistence)();
    const settings = (0, internal_1.getCloudSDKSettingsServer)();
    const browserId = (0, internal_1.getCookieValueFromRequest)(request, settings.cookieSettings.name.browserId);
    // Host is irrelevant but necessary to support relative URL
    const requestUrl = new URL(request.url, `https://localhost`);
    return new page_view_event_1.PageViewEvent({
        id: browserId,
        pageViewData,
        searchParams: requestUrl.search,
        sendEvent: sendEvent_1.sendEvent,
        settings
    }).send();
}
exports.pageViewServer = pageViewServer;
